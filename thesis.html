<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Project 2: Master’s thesis</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>
<script src="site_libs/htmlwidgets-0.7/htmlwidgets.js"></script>
<link href="site_libs/plotlyjs-1.16.3/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="site_libs/plotlyjs-1.16.3/plotly-latest.min.js"></script>
<script src="site_libs/plotly-binding-4.5.6/plotly.js"></script>
<meta name="description" content="Turn your analyses into high quality documents, reports, presentations and dashboards with R Markdown. Use a productive notebook interface to weave together narrative text and code to produce elegantly formatted output. Use multiple languages including R, Python, and SQL. R Markdown supports a reproducible workflow for dozens of static and dynamic output formats including HTML, PDF, MS Word, Beamer, HTML5 slides, Tufte-style handouts, books, dashboards, shiny applications, scientific articles, websites, and more." />

<link rel="icon" type="image/png" href="images/favicon.png" />

<script type="text/javascript" src="js/rmarkdown.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-20375833-14', 'auto');
  ga('send', 'pageview');
</script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="css/rmarkdown.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>



<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">



<div id="rStudioHeader" class="alwaysShrunk">
  <div class="innards bandContent">
    <div>
    <a class="productName" href="index.html"> Martin Haringa </a>
      <div class="rStudio"><span class="light"> </span> 
      <a href="https://www.rstudio.com/"><div class="logo"></div></a></div>
        </div>
        
        <div id="menu">
          <div id="menuToggler"></div>
            <div id="menuItems">
              <a class="menuItem" href="index.html">Home</a>
                <a class="menuItem" href="concentration.html">Project 1: Concentration risk</a>
                  <a class="menuItem" href="thesis.html">Project 2: Master's thesis</a>
                  <a class="menuItem" href="aboutme.html">About me</a>
                    <a class="menuItem" href="contact.html">Contact me</a>
                      <a class="menuItem gitHub" href="https://github.com/mharinga"></a>
                        <a class="menuItem gitHubText" href="https://github.com/mharinga">Source on GitHub</a>
                          </div>
                          </div>
                          </div>
                          </div>
                          
                          <style type="text/css">
                            #TOC {
                            margin-left: 35px;
                          margin-top: 90px;
                          }
</style>
  
  <script type="text/javascript">
    $(".main-container").removeClass("main-container").removeClass("container-fluid").addClass("footerPushDown");
  </script>
    
    
    <div id="pageContent" class="standardPadding">
      <div class="articleBandContent">

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Project 2: Master’s thesis</h1>

</div>


<p>The project below describes parts of my Master’s thesis to obtain my degree in Actuarial Science and Mathematical Finance. The thesis was nominated for the Johan de Witt award for the best actuarial thesis in 2016.</p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>If you want to learn practical data science (as opposed to theoretical, academic topics) you need to be able to take a dataset, wrangle it into shape, and use visualization and other techniques to find insights. Therefore it is essential to obtain a solid foundation in two core skill areas:</p>
<ul>
<li>Data manipulation;</li>
<li>Data visualization.</li>
</ul>
<p>In practical terms, this means that as an R user, you should know <em>ggplot2</em> and <em>dplyr</em> at a minimum. Also learning a few other parts of the tidyverse, like <em>tidyr</em>, and <em>lubridate</em>, is recommended. The tidyverse is a set of packages that work in harmony because they share common data representations. It is powerful for wrangling, visualizing, and analyzing data.</p>
<p>This project shows how these two core skills are applied to a large motor insurance portfolio from a Belgian non-life insurer. It contains parts of my master’s thesis.</p>
<p>First things first: we need to get the data and hammer it into shape.</p>
</div>
<div id="read-the-data" class="section level1">
<h1>Read the data</h1>
<p>First, we need to get the data. Import it using the readr package:</p>
<pre class="r"><code>library(readr)
mtpl_data_1997 &lt;- read_delim(&quot;mtpl_data_1997.txt&quot;, &quot;\t&quot;,
                             escape_double = FALSE, 
                             trim_ws = TRUE, 
                             progress = FALSE)</code></pre>
<p>After reading in the data, we’ll examine the data using glimpse().</p>
<p>This will give us the names of the columns, the dimensions of the data, and will print out the first several observations. It is important to routinely examine your data after you change it. Essentially, as you execute a procedure, you want to make sure that the procedure did what you wanted it to.</p>
<pre class="r"><code># INSPECT 
glimpse(mtpl_data_1997)</code></pre>
<pre><code>## Observations: 163,660
## Variables: 9
## $ NCLAIMS  &lt;int&gt; 1, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ DURATION &lt;int&gt; 365, 365, 365, 365, 17, 365, 365, 147, 365, 365, 89, ...
## $ AGEPH    &lt;dbl&gt; 50, 64, 60, 77, 28, 26, 26, 58, 43, 70, 34, 37, 34, 4...
## $ AGEC     &lt;int&gt; 12, 3, 10, 15, 7, 12, 8, 14, 6, 2, 7, 4, 11, 15, 5, 8...
## $ POWER    &lt;int&gt; 77, 66, 70, 57, 70, 70, 55, 47, 65, 76, 102, 66, 58, ...
## $ SPORT    &lt;int&gt; 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 2, 2, 2,...
## $ CODPOSS  &lt;int&gt; 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1000, 1030,...
## $ TOWN     &lt;chr&gt; &quot;BRUSSEL&quot;, &quot;BRUSSEL&quot;, &quot;BRUSSEL&quot;, &quot;BRUSSEL&quot;, &quot;BRUSSEL&quot;...
## $ MAKE     &lt;chr&gt; &quot;ALFA ROMEO 33 1.5 TI&quot;, &quot;ALFA ROMEO 145 1.4I&quot;, &quot;ALFA ...</code></pre>
<p>The data set at hand consists of 163,660 records concerning a Belgian motor thirdparty liability (MTPL hereafter) insurance portfolio. All the observations relate to the year 1997.</p>
</div>
<div id="rename-variables" class="section level1">
<h1>Rename variables</h1>
<p>Next, we’re going to rename our variables by transforming them all to lower case. In programming, there are several different style conventions, but many people will tell you that there’s no good reason to have a capitalized first letter for a variable name. In most situations, you’ll want to remove capitals, if for no other reason than it makes them easier to type.</p>
<p>To execute this, we’re going to use colnames() and tolower(). Here, we’re using the pipe operator (%&gt;%) to ‘pipe’ the names into tolower(). The pipe operator can be read as ‘and then’.</p>
<pre class="r"><code>#LOWER CASE
colnames(mtpl_data_1997) &lt;- colnames(mtpl_data_1997) %&gt;% tolower()

#INSPECT
colnames(mtpl_data_1997)</code></pre>
<pre><code>## [1] &quot;nclaims&quot;  &quot;duration&quot; &quot;ageph&quot;    &quot;agec&quot;     &quot;power&quot;    &quot;sport&quot;   
## [7] &quot;codposs&quot;  &quot;town&quot;     &quot;make&quot;</code></pre>
</div>
<div id="create-histograms" class="section level1">
<h1>Create histograms</h1>
<p>To obtain insights in the distribution of the data on the policyholder’s level, histograms are created for the age of the policyholder, age of the vehicle, and power of the vehicle, using the <em>ggplot2</em> library in R.</p>
<pre class="r"><code># LOAD LIBRARIES
library(ggplot2)
library(ggthemes)


# CREATE HISTOGRAMS
ageph_histogram &lt;- ggplot(data = mtpl_data_1997, aes(x = ageph)) + 
  geom_histogram(aes(y = ..density..), bins = 79, fill = &quot;dodgerblue&quot;) +
  scale_x_continuous(breaks = extended_range_breaks()(mtpl_data_1997$ageph)) +
  ylab(&quot;Density&quot;) + xlab(&quot;Age policyholder (years)&quot;) + 
  theme_bw() #theme with a white background

agec_histogram &lt;- ggplot(data = mtpl_data_1997, aes(x = agec)) + 
  geom_histogram(aes(y = ..density..), bins = 50, fill = &quot;dodgerblue&quot;) +
  scale_x_continuous(breaks = extended_range_breaks()(mtpl_data_1997$agec)) +
  ylab(&quot;Density&quot;) + xlab(&quot;Age vehicle (years)&quot;) + theme_bw() 

power_histogram &lt;- ggplot(data = mtpl_data_1997, aes(x = power)) +
  geom_histogram(aes(y = ..density..), bins = 70, fill = &quot;dodgerblue&quot;) +
  scale_x_continuous(breaks = extended_range_breaks()(mtpl_data_1997$ageph)) +
  ylab(&quot;Density&quot;) + xlab(&quot;Power vehicle (kW)&quot;) + theme_bw()</code></pre>
<p>Use ggplot2 with plotly to obtain interactive ggplot2 charts:</p>
<pre class="r"><code># LOAD LIBRARY
library(plotly)

# CREATE INTERACTIVE GGPLOT2 CHARTS
ggplotly(ageph_histogram)</code></pre>
<div id="htmlwidget-0b493c0b40d8eb5a6e7a" style="width:1056px;height:336px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-0b493c0b40d8eb5a6e7a">{"x":{"data":[{"x":[17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95],"y":[1.22204570450935e-05,0.000103873884883295,0.000708786508615422,0.00240131980936087,0.00430160087987291,0.00582304778198705,0.00843211536111451,0.0124282048148601,0.0163631919833802,0.0179946229989002,0.0191677868752291,0.0195710619577172,0.0199010142979347,0.0215874373701576,0.0212574850299401,0.0226567273616033,0.0228522546743248,0.0227300501038739,0.0227056091897837,0.0233166320420384,0.0235854820970304,0.0237810094097519,0.0238421116949774,0.0236282536966883,0.0237443480386166,0.023793229866797,0.024508126603935,0.0234449468410119,0.0238971037516803,0.0222595625076378,0.0241415128925822,0.0223023341072956,0.0244836856898448,0.0240254185506538,0.0239582060369058,0.0193144323597703,0.0194305267016986,0.0182207014542344,0.0151778076500061,0.013925210802884,0.0174508126603935,0.015813271416351,0.0158438225589637,0.0140840767444702,0.0147989734816082,0.0138946596602713,0.013399731149945,0.0140779665159477,0.0141573994867408,0.0146828791396798,0.0140718562874252,0.0126481730416718,0.0119516069901014,0.0114505682512526,0.0101185384333374,0.00990468043504827,0.00932420872540633,0.00819381644873518,0.0078699743370402,0.00700232188683857,0.00617744103629476,0.00402053036783576,0.00236465843822559,0.00185139924233166,0.00173530490040328,0.00174141512892582,0.00158865941586215,0.00113650250519369,0.000995967249175119,0.000604912623732128,0.000366613711352805,0.000366613711352805,0.000171086398631309,8.55431993156544e-05,7.33227422705609e-05,9.77636563607479e-05,5.49920567029207e-05,1.83306855676402e-05,3.05511426127337e-05],"text":["density: 0<br>count: 0<br>ageph: 17","density: 0<br>count: 0<br>ageph: 18","density: 0<br>count: 0<br>ageph: 19","density: 0<br>count: 0<br>ageph: 20","density: 0<br>count: 0<br>ageph: 21","density: 0.01<br>count: 0.01<br>ageph: 22","density: 0.01<br>count: 0.01<br>ageph: 23","density: 0.01<br>count: 0.01<br>ageph: 24","density: 0.02<br>count: 0.02<br>ageph: 25","density: 0.02<br>count: 0.02<br>ageph: 26","density: 0.02<br>count: 0.02<br>ageph: 27","density: 0.02<br>count: 0.02<br>ageph: 28","density: 0.02<br>count: 0.02<br>ageph: 29","density: 0.02<br>count: 0.02<br>ageph: 30","density: 0.02<br>count: 0.02<br>ageph: 31","density: 0.02<br>count: 0.02<br>ageph: 32","density: 0.02<br>count: 0.02<br>ageph: 33","density: 0.02<br>count: 0.02<br>ageph: 34","density: 0.02<br>count: 0.02<br>ageph: 35","density: 0.02<br>count: 0.02<br>ageph: 36","density: 0.02<br>count: 0.02<br>ageph: 37","density: 0.02<br>count: 0.02<br>ageph: 38","density: 0.02<br>count: 0.02<br>ageph: 39","density: 0.02<br>count: 0.02<br>ageph: 40","density: 0.02<br>count: 0.02<br>ageph: 41","density: 0.02<br>count: 0.02<br>ageph: 42","density: 0.02<br>count: 0.02<br>ageph: 43","density: 0.02<br>count: 0.02<br>ageph: 44","density: 0.02<br>count: 0.02<br>ageph: 45","density: 0.02<br>count: 0.02<br>ageph: 46","density: 0.02<br>count: 0.02<br>ageph: 47","density: 0.02<br>count: 0.02<br>ageph: 48","density: 0.02<br>count: 0.02<br>ageph: 49","density: 0.02<br>count: 0.02<br>ageph: 50","density: 0.02<br>count: 0.02<br>ageph: 51","density: 0.02<br>count: 0.02<br>ageph: 52","density: 0.02<br>count: 0.02<br>ageph: 53","density: 0.02<br>count: 0.02<br>ageph: 54","density: 0.02<br>count: 0.02<br>ageph: 55","density: 0.01<br>count: 0.01<br>ageph: 56","density: 0.02<br>count: 0.02<br>ageph: 57","density: 0.02<br>count: 0.02<br>ageph: 58","density: 0.02<br>count: 0.02<br>ageph: 59","density: 0.01<br>count: 0.01<br>ageph: 60","density: 0.01<br>count: 0.01<br>ageph: 61","density: 0.01<br>count: 0.01<br>ageph: 62","density: 0.01<br>count: 0.01<br>ageph: 63","density: 0.01<br>count: 0.01<br>ageph: 64","density: 0.01<br>count: 0.01<br>ageph: 65","density: 0.01<br>count: 0.01<br>ageph: 66","density: 0.01<br>count: 0.01<br>ageph: 67","density: 0.01<br>count: 0.01<br>ageph: 68","density: 0.01<br>count: 0.01<br>ageph: 69","density: 0.01<br>count: 0.01<br>ageph: 70","density: 0.01<br>count: 0.01<br>ageph: 71","density: 0.01<br>count: 0.01<br>ageph: 72","density: 0.01<br>count: 0.01<br>ageph: 73","density: 0.01<br>count: 0.01<br>ageph: 74","density: 0.01<br>count: 0.01<br>ageph: 75","density: 0.01<br>count: 0.01<br>ageph: 76","density: 0.01<br>count: 0.01<br>ageph: 77","density: 0<br>count: 0<br>ageph: 78","density: 0<br>count: 0<br>ageph: 79","density: 0<br>count: 0<br>ageph: 80","density: 0<br>count: 0<br>ageph: 81","density: 0<br>count: 0<br>ageph: 82","density: 0<br>count: 0<br>ageph: 83","density: 0<br>count: 0<br>ageph: 84","density: 0<br>count: 0<br>ageph: 85","density: 0<br>count: 0<br>ageph: 86","density: 0<br>count: 0<br>ageph: 87","density: 0<br>count: 0<br>ageph: 88","density: 0<br>count: 0<br>ageph: 89","density: 0<br>count: 0<br>ageph: 90","density: 0<br>count: 0<br>ageph: 91","density: 0<br>count: 0<br>ageph: 92","density: 0<br>count: 0<br>ageph: 93","density: 0<br>count: 0<br>ageph: 94","density: 0<br>count: 0<br>ageph: 95"],"key":null,"type":"bar","marker":{"autocolorscale":false,"color":"rgba(30,144,255,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","name":""}],"layout":{"margin":{"t":38.9615133724723,"r":7.30593607305936,"b":52.9158512720157,"l":54.7945205479452},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[12.55,99.45],"ticktext":["17","30","40","50","60","70","80","95"],"tickvals":[17,30,40,50,60,70,80,95],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"Age policyholder (years)","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[-0.00122540633019675,0.0257335329341317],"ticktext":["0.000","0.005","0.010","0.015","0.020","0.025"],"tickvals":[0,0.005,0.01,0.015,0.02,0.025],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"Density","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"barmode":"stack","bargap":0,"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"modeBarButtonsToRemove":["sendDataToCloud"]},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<pre class="r"><code>ggplotly(agec_histogram)</code></pre>
<div id="htmlwidget-dd714cddbb126fe7459b" style="width:1056px;height:336px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-dd714cddbb126fe7459b">{"x":{"data":[{"x":[0,0.979591836734694,1.95918367346939,2.93877551020408,3.91836734693878,4.89795918367347,5.87755102040816,6.85714285714286,7.83673469387755,8.81632653061224,9.79591836734694,10.7755102040816,11.7551020408163,12.734693877551,13.7142857142857,14.6938775510204,15.6734693877551,16.6530612244898,17.6326530612245,18.6122448979592,19.5918367346939,20.5714285714286,21.5510204081633,22.530612244898,23.5102040816327,24.4897959183673,25.469387755102,26.4489795918367,27.4285714285714,28.4081632653061,29.3877551020408,30.3673469387755,31.3469387755102,32.3265306122449,33.3061224489796,34.2857142857143,35.265306122449,36.2448979591837,37.2244897959184,38.2040816326531,39.1836734693878,40.1632653061224,41.1428571428571,42.1224489795918,43.1020408163265,44.0816326530612,45.0612244897959,46.0408163265306,47.0204081632653,48],"y":[0.00122879241516966,0.0472118263473054,0.0857035928143713,0.0781811377245509,0.0798652694610778,0.0778505489021957,0.0941367265469062,0.0868388223552894,0.0875499001996009,0.0781437125748502,0.0722055888223553,0.062936626746507,0.0521581836327345,0.0397829341317366,0.0273390718562874,0.018063872255489,0.0123627744510978,0.00624376247504992,0.00377994011976047,0.00271332335329341,0.00172155688622755,0.00131611776447106,0.000742265469061875,0.000368013972055889,0.00031187624750499,0,0.000318113772455089,0.000280688622754492,0.000212075848303393,0.000180888223552894,0.000193363273453094,0.000130988023952096,6.8612774451098e-05,9.98003992015967e-05,6.8612774451098e-05,1.87125748502994e-05,6.86127744510975e-05,1.87125748502994e-05,7.48502994011978e-05,1.87125748502993e-05,1.87125748502994e-05,4.36626746506987e-05,4.99001996007982e-05,3.74251497005989e-05,3.11876247504991e-05,1.24750499001995e-05,3.11876247504991e-05,7.48502994011978e-05,1.24750499001995e-05,1.24750499001996e-05],"text":["density: 0<br>count: 0<br>agec: 0","density: 0.05<br>count: 0.05<br>agec: 0.98","density: 0.09<br>count: 0.09<br>agec: 1.96","density: 0.08<br>count: 0.08<br>agec: 2.94","density: 0.08<br>count: 0.08<br>agec: 3.92","density: 0.08<br>count: 0.08<br>agec: 4.9","density: 0.09<br>count: 0.09<br>agec: 5.88","density: 0.09<br>count: 0.09<br>agec: 6.86","density: 0.09<br>count: 0.09<br>agec: 7.84","density: 0.08<br>count: 0.08<br>agec: 8.82","density: 0.07<br>count: 0.07<br>agec: 9.8","density: 0.06<br>count: 0.06<br>agec: 10.78","density: 0.05<br>count: 0.05<br>agec: 11.76","density: 0.04<br>count: 0.04<br>agec: 12.73","density: 0.03<br>count: 0.03<br>agec: 13.71","density: 0.02<br>count: 0.02<br>agec: 14.69","density: 0.01<br>count: 0.01<br>agec: 15.67","density: 0.01<br>count: 0.01<br>agec: 16.65","density: 0<br>count: 0<br>agec: 17.63","density: 0<br>count: 0<br>agec: 18.61","density: 0<br>count: 0<br>agec: 19.59","density: 0<br>count: 0<br>agec: 20.57","density: 0<br>count: 0<br>agec: 21.55","density: 0<br>count: 0<br>agec: 22.53","density: 0<br>count: 0<br>agec: 23.51","density: 0<br>count: 0<br>agec: 24.49","density: 0<br>count: 0<br>agec: 25.47","density: 0<br>count: 0<br>agec: 26.45","density: 0<br>count: 0<br>agec: 27.43","density: 0<br>count: 0<br>agec: 28.41","density: 0<br>count: 0<br>agec: 29.39","density: 0<br>count: 0<br>agec: 30.37","density: 0<br>count: 0<br>agec: 31.35","density: 0<br>count: 0<br>agec: 32.33","density: 0<br>count: 0<br>agec: 33.31","density: 0<br>count: 0<br>agec: 34.29","density: 0<br>count: 0<br>agec: 35.27","density: 0<br>count: 0<br>agec: 36.24","density: 0<br>count: 0<br>agec: 37.22","density: 0<br>count: 0<br>agec: 38.2","density: 0<br>count: 0<br>agec: 39.18","density: 0<br>count: 0<br>agec: 40.16","density: 0<br>count: 0<br>agec: 41.14","density: 0<br>count: 0<br>agec: 42.12","density: 0<br>count: 0<br>agec: 43.1","density: 0<br>count: 0<br>agec: 44.08","density: 0<br>count: 0<br>agec: 45.06","density: 0<br>count: 0<br>agec: 46.04","density: 0<br>count: 0<br>agec: 47.02","density: 0<br>count: 0<br>agec: 48"],"key":null,"type":"bar","marker":{"autocolorscale":false,"color":"rgba(30,144,255,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","name":""}],"layout":{"margin":{"t":38.9615133724723,"r":7.30593607305936,"b":52.9158512720157,"l":54.7945205479452},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[-2.93877551020408,50.9387755102041],"ticktext":["0","10","20","30","48"],"tickvals":[0,10,20,30,48],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"Age vehicle (years)","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[-0.00470683632734531,0.0988435628742515],"ticktext":["0.000","0.025","0.050","0.075"],"tickvals":[0,0.025,0.05,0.075],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"Density","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"barmode":"stack","bargap":0,"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"modeBarButtonsToRemove":["sendDataToCloud"]},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
<pre class="r"><code>ggplotly(power_histogram)</code></pre>
<div id="htmlwidget-229e89a6d7e16a2455a6" style="width:1056px;height:336px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-229e89a6d7e16a2455a6">{"x":{"data":[{"x":[10.4347826086957,13.9130434782609,17.3913043478261,20.8695652173913,24.3478260869565,27.8260869565217,31.304347826087,34.7826086956522,38.2608695652174,41.7391304347826,45.2173913043478,48.695652173913,52.1739130434783,55.6521739130435,59.1304347826087,62.6086956521739,66.0869565217391,69.5652173913043,73.0434782608696,76.5217391304348,80,83.4782608695652,86.9565217391304,90.4347826086957,93.9130434782609,97.3913043478261,100.869565217391,104.347826086957,107.826086956522,111.304347826087,114.782608695652,118.260869565217,121.739130434783,125.217391304348,128.695652173913,132.173913043478,135.652173913043,139.130434782609,142.608695652174,146.086956521739,149.565217391304,153.04347826087,156.521739130435,160,163.478260869565,166.95652173913,170.434782608696,173.913043478261,177.391304347826,180.869565217391,184.347826086957,187.826086956522,191.304347826087,194.782608695652,198.260869565217,201.739130434783,205.217391304348,208.695652173913,212.173913043478,215.652173913043,219.130434782609,222.608695652174,226.086956521739,229.565217391304,233.04347826087,236.521739130435,240,243.478260869565,246.95652173913,250.434782608696],"y":[3.51338140046438e-06,1.58102163020897e-05,0.000319717707442258,0.000613085054381034,0.00157575155810827,0.00236977575461322,0.0157153550042772,0.00517345411218379,0.039773234143957,0.017333267139191,0.0191180648906269,0.0251048667970182,0.0169222015153367,0.0382730202859588,0.0117996914334596,0.00834603751680313,0.0300218440669681,0.00887304472687278,0.0045955028718074,0.00698811560552364,0.00366445680068434,0.0114887571795185,0.00137197543688134,0.00382782903580594,0.00189019919344983,0.00286867591347916,0.00249977086643041,0.00168466638152267,0.000592004765978247,0.00183047170964194,0.000398768788952707,0.000154588781620433,0.000198506049126237,0.00039349871685201,0.000182695832824148,0.000100131369913235,0.000180939142123917,0.000179182451423683,0.000328501160943419,9.13479164120738e-05,9.48612978125382e-05,8.78345350116094e-06,0.000149318709519736,1.93235977025541e-05,7.20243187095197e-05,2.45936698032506e-05,9.48612978125382e-05,5.27007210069656e-06,1.22968349016253e-05,8.78345350116094e-06,3.86471954051081e-05,0,5.27007210069656e-06,0,1.75669070023219e-05,5.27007210069656e-06,8.78345350116094e-06,3.51338140046438e-05,0,5.27007210069656e-06,8.78345350116094e-06,3.51338140046438e-06,1.75669070023219e-06,1.75669070023219e-06,1.75669070023219e-06,5.27007210069656e-06,5.27007210069656e-06,1.75669070023219e-06,0,1.75669070023219e-06],"text":["density: 0<br>count: 0<br>power: 10.43","density: 0<br>count: 0<br>power: 13.91","density: 0<br>count: 0<br>power: 17.39","density: 0<br>count: 0<br>power: 20.87","density: 0<br>count: 0<br>power: 24.35","density: 0<br>count: 0<br>power: 27.83","density: 0.02<br>count: 0.02<br>power: 31.3","density: 0.01<br>count: 0.01<br>power: 34.78","density: 0.04<br>count: 0.04<br>power: 38.26","density: 0.02<br>count: 0.02<br>power: 41.74","density: 0.02<br>count: 0.02<br>power: 45.22","density: 0.03<br>count: 0.03<br>power: 48.7","density: 0.02<br>count: 0.02<br>power: 52.17","density: 0.04<br>count: 0.04<br>power: 55.65","density: 0.01<br>count: 0.01<br>power: 59.13","density: 0.01<br>count: 0.01<br>power: 62.61","density: 0.03<br>count: 0.03<br>power: 66.09","density: 0.01<br>count: 0.01<br>power: 69.57","density: 0<br>count: 0<br>power: 73.04","density: 0.01<br>count: 0.01<br>power: 76.52","density: 0<br>count: 0<br>power: 80","density: 0.01<br>count: 0.01<br>power: 83.48","density: 0<br>count: 0<br>power: 86.96","density: 0<br>count: 0<br>power: 90.43","density: 0<br>count: 0<br>power: 93.91","density: 0<br>count: 0<br>power: 97.39","density: 0<br>count: 0<br>power: 100.87","density: 0<br>count: 0<br>power: 104.35","density: 0<br>count: 0<br>power: 107.83","density: 0<br>count: 0<br>power: 111.3","density: 0<br>count: 0<br>power: 114.78","density: 0<br>count: 0<br>power: 118.26","density: 0<br>count: 0<br>power: 121.74","density: 0<br>count: 0<br>power: 125.22","density: 0<br>count: 0<br>power: 128.7","density: 0<br>count: 0<br>power: 132.17","density: 0<br>count: 0<br>power: 135.65","density: 0<br>count: 0<br>power: 139.13","density: 0<br>count: 0<br>power: 142.61","density: 0<br>count: 0<br>power: 146.09","density: 0<br>count: 0<br>power: 149.57","density: 0<br>count: 0<br>power: 153.04","density: 0<br>count: 0<br>power: 156.52","density: 0<br>count: 0<br>power: 160","density: 0<br>count: 0<br>power: 163.48","density: 0<br>count: 0<br>power: 166.96","density: 0<br>count: 0<br>power: 170.43","density: 0<br>count: 0<br>power: 173.91","density: 0<br>count: 0<br>power: 177.39","density: 0<br>count: 0<br>power: 180.87","density: 0<br>count: 0<br>power: 184.35","density: 0<br>count: 0<br>power: 187.83","density: 0<br>count: 0<br>power: 191.3","density: 0<br>count: 0<br>power: 194.78","density: 0<br>count: 0<br>power: 198.26","density: 0<br>count: 0<br>power: 201.74","density: 0<br>count: 0<br>power: 205.22","density: 0<br>count: 0<br>power: 208.7","density: 0<br>count: 0<br>power: 212.17","density: 0<br>count: 0<br>power: 215.65","density: 0<br>count: 0<br>power: 219.13","density: 0<br>count: 0<br>power: 222.61","density: 0<br>count: 0<br>power: 226.09","density: 0<br>count: 0<br>power: 229.57","density: 0<br>count: 0<br>power: 233.04","density: 0<br>count: 0<br>power: 236.52","density: 0<br>count: 0<br>power: 240","density: 0<br>count: 0<br>power: 243.48","density: 0<br>count: 0<br>power: 246.96","density: 0<br>count: 0<br>power: 250.43"],"key":null,"type":"bar","marker":{"autocolorscale":false,"color":"rgba(30,144,255,1)","line":{"width":1.88976377952756,"color":"transparent"}},"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","name":""}],"layout":{"margin":{"t":38.9615133724723,"r":7.30593607305936,"b":52.9158512720157,"l":48.9497716894977},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[-3.47826086956522,264.347826086957],"ticktext":["17","30","40","50","60","70","80","95"],"tickvals":[17,30,40,50,60,70,80,95],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":"Power vehicle (kW)","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"type":"linear","autorange":false,"tickmode":"array","range":[-0.00198866170719785,0.0417618958511548],"ticktext":["0.00","0.01","0.02","0.03","0.04"],"tickvals":[0,0.01,0.02,0.03,0.04],"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(235,235,235,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":"Density","titlefont":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(51,51,51,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":false,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895}},"barmode":"stack","bargap":0,"hovermode":"closest"},"source":"A","config":{"modeBarButtonsToAdd":[{"name":"Collaborate","icon":{"width":1000,"ascent":500,"descent":-50,"path":"M487 375c7-10 9-23 5-36l-79-259c-3-12-11-23-22-31-11-8-22-12-35-12l-263 0c-15 0-29 5-43 15-13 10-23 23-28 37-5 13-5 25-1 37 0 0 0 3 1 7 1 5 1 8 1 11 0 2 0 4-1 6 0 3-1 5-1 6 1 2 2 4 3 6 1 2 2 4 4 6 2 3 4 5 5 7 5 7 9 16 13 26 4 10 7 19 9 26 0 2 0 5 0 9-1 4-1 6 0 8 0 2 2 5 4 8 3 3 5 5 5 7 4 6 8 15 12 26 4 11 7 19 7 26 1 1 0 4 0 9-1 4-1 7 0 8 1 2 3 5 6 8 4 4 6 6 6 7 4 5 8 13 13 24 4 11 7 20 7 28 1 1 0 4 0 7-1 3-1 6-1 7 0 2 1 4 3 6 1 1 3 4 5 6 2 3 3 5 5 6 1 2 3 5 4 9 2 3 3 7 5 10 1 3 2 6 4 10 2 4 4 7 6 9 2 3 4 5 7 7 3 2 7 3 11 3 3 0 8 0 13-1l0-1c7 2 12 2 14 2l218 0c14 0 25-5 32-16 8-10 10-23 6-37l-79-259c-7-22-13-37-20-43-7-7-19-10-37-10l-248 0c-5 0-9-2-11-5-2-3-2-7 0-12 4-13 18-20 41-20l264 0c5 0 10 2 16 5 5 3 8 6 10 11l85 282c2 5 2 10 2 17 7-3 13-7 17-13z m-304 0c-1-3-1-5 0-7 1-1 3-2 6-2l174 0c2 0 4 1 7 2 2 2 4 4 5 7l6 18c0 3 0 5-1 7-1 1-3 2-6 2l-173 0c-3 0-5-1-8-2-2-2-4-4-4-7z m-24-73c-1-3-1-5 0-7 2-2 3-2 6-2l174 0c2 0 5 0 7 2 3 2 4 4 5 7l6 18c1 2 0 5-1 6-1 2-3 3-5 3l-174 0c-3 0-5-1-7-3-3-1-4-4-5-6z"},"click":"function(gd) { \n        // is this being viewed in RStudio?\n        if (location.search == '?viewer_pane=1') {\n          alert('To learn about plotly for collaboration, visit:\\n https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html');\n        } else {\n          window.open('https://cpsievert.github.io/plotly_book/plot-ly-for-collaboration.html', '_blank');\n        }\n      }"}],"modeBarButtonsToRemove":["sendDataToCloud"]},"base_url":"https://plot.ly"},"evals":["config.modeBarButtonsToAdd.0.click"],"jsHooks":[]}</script>
</div>
<div id="choropleth-maps" class="section level1">
<h1>Choropleth maps</h1>
<p>To obtain better insights in the overall geographic patterns of the number of claims per municipality in Belgium, choropleth maps are used. A choropleth map is a thematic map in which areas are shaded or patterned in proportion to the measurements of the statistical variable being displayed on the map.</p>
<pre class="r"><code># LOAD LIBRARY
library(dplyr)

# SUMMARIZE NUMBER OF CLAIMS AND EXPOSURE PER POSTAL CODE
nclaims_per_codposs &lt;- mtpl_data_1997 %&gt;%
  group_by(codposs) %&gt;%
  summarize(nclaims = sum(nclaims), exposure = n()) %&gt;%
  mutate(claim_ratio = round(nclaims / exposure, 3))

glimpse(nclaims_per_codposs)</code></pre>
<pre><code>## Observations: 583
## Variables: 4
## $ codposs     &lt;int&gt; 1000, 1030, 1040, 1050, 1060, 1070, 1080, 1081, 10...
## $ nclaims     &lt;int&gt; 235, 184, 110, 139, 81, 214, 167, 21, 30, 32, 70, ...
## $ exposure    &lt;int&gt; 1181, 928, 433, 643, 345, 1042, 736, 128, 193, 223...
## $ claim_ratio &lt;dbl&gt; 0.199, 0.198, 0.254, 0.216, 0.235, 0.205, 0.227, 0...</code></pre>
<p>The spatial object on the municipality level is obtained from the Global Administrative Areas (GADM) database (<a href="http://www.gadm.org" class="uri">http://www.gadm.org</a>) in a R (SpatialPolygonsDataFrame) format.</p>
<pre class="r"><code>#install.packages(&quot;gpclib&quot;, type = &quot;source&quot;)
#library(gpclib)
library(rgeos)
#gpclibPermit() #turn on the license
#gpclibPermit()
belgium_shapefile &lt;- readRDS(&quot;BEL_adm4.rds&quot;) #load shapefile
belgie_fortify0 &lt;- fortify(belgium_shapefile, region = &quot;NAME_4&quot;) 

glimpse(belgie_fortify)</code></pre>
<pre class="r"><code>library(gsubfn)

unwanted_array &lt;- list(    &#39;Š&#39;=&#39;S&#39;, &#39;š&#39;=&#39;s&#39;, &#39;Ž&#39;=&#39;Z&#39;, &#39;ž&#39;=&#39;z&#39;, &#39;À&#39;=&#39;A&#39;, &#39;Á&#39;=&#39;A&#39;, &#39;Â&#39;=&#39;A&#39;, &#39;Ã&#39;=&#39;A&#39;, &#39;Ä&#39;=&#39;A&#39;, &#39;Å&#39;=&#39;A&#39;, &#39;Æ&#39;=&#39;A&#39;, &#39;Ç&#39;=&#39;C&#39;, &#39;È&#39;=&#39;E&#39;, &#39;É&#39;=&#39;E&#39;,
                           &#39;Ê&#39;=&#39;E&#39;, &#39;Ë&#39;=&#39;E&#39;, &#39;Ì&#39;=&#39;I&#39;, &#39;Í&#39;=&#39;I&#39;, &#39;Î&#39;=&#39;I&#39;, &#39;Ï&#39;=&#39;I&#39;, &#39;Ñ&#39;=&#39;N&#39;, &#39;Ò&#39;=&#39;O&#39;, &#39;Ó&#39;=&#39;O&#39;, &#39;Ô&#39;=&#39;O&#39;, &#39;Õ&#39;=&#39;O&#39;, &#39;Ö&#39;=&#39;O&#39;, &#39;Ø&#39;=&#39;O&#39;, &#39;Ù&#39;=&#39;U&#39;,
                           &#39;Ú&#39;=&#39;U&#39;, &#39;Û&#39;=&#39;U&#39;, &#39;Ü&#39;=&#39;U&#39;, &#39;Ý&#39;=&#39;Y&#39;, &#39;Þ&#39;=&#39;B&#39;, &#39;ß&#39;=&#39;Ss&#39;, &#39;à&#39;=&#39;a&#39;, &#39;á&#39;=&#39;a&#39;, &#39;â&#39;=&#39;a&#39;, &#39;ã&#39;=&#39;a&#39;, &#39;ä&#39;=&#39;a&#39;, &#39;å&#39;=&#39;a&#39;, &#39;æ&#39;=&#39;a&#39;, &#39;ç&#39;=&#39;c&#39;,
                           &#39;è&#39;=&#39;e&#39;, &#39;é&#39;=&#39;e&#39;, &#39;ê&#39;=&#39;e&#39;, &#39;ë&#39;=&#39;e&#39;, &#39;ì&#39;=&#39;i&#39;, &#39;í&#39;=&#39;i&#39;, &#39;î&#39;=&#39;i&#39;, &#39;ï&#39;=&#39;i&#39;, &#39;ð&#39;=&#39;o&#39;, &#39;ñ&#39;=&#39;n&#39;, &#39;ò&#39;=&#39;o&#39;, &#39;ó&#39;=&#39;o&#39;, &#39;ô&#39;=&#39;o&#39;, &#39;õ&#39;=&#39;o&#39;,
                           &#39;ö&#39;=&#39;o&#39;, &#39;ø&#39;=&#39;o&#39;, &#39;ù&#39;=&#39;u&#39;, &#39;ú&#39;=&#39;u&#39;, &#39;û&#39;=&#39;u&#39;, &#39;ý&#39;=&#39;y&#39;, &#39;ý&#39;=&#39;y&#39;, &#39;þ&#39;=&#39;b&#39;, &#39;ÿ&#39;=&#39;y&#39; )

#again but now eliminating punctuation marks in municipality names
belgie_fortify1 &lt;- belgie_fortify %&gt;% 
  mutate(id = gsubfn(paste(names(unwanted_array), collapse = &#39;|&#39;), unwanted_array, toupper(id))) 

glimpse(belgie_fortify1)</code></pre>
<pre class="r"><code>library(RColorBrewer)
library(classInt)
library(ggmap)

RedYellowGreen7 &lt;- rev(brewer.pal(7, &#39;RdYlGn&#39;))
Blues7 &lt;- brewer.pal(7, &#39;Blues&#39;)

#fisher jenks breaks function
fisher7 &lt;- function(data){
  classIntervals(data, n=7, style=&#39;fisher&#39;, intervalClosure=&#39;right&#39;)[[2]]
}

#transparent legend
transparent_legend =  theme(
  legend.background = element_rect(fill = &quot;transparent&quot;),
  legend.key = element_rect(fill = &quot;transparent&quot;, color = &quot;transparent&quot;)
)

#function to plot maps
map_belgium_disc &lt;- function(data, mapping, naam, palette) {
  ggplot(data, aes(x = long, y = lat, group = group)) + #data should be object produced by fortify function
    geom_polygon(mapping) + #choose which categorized variable should be plotted
    scale_fill_manual(name = naam, values = palette) +
    coord_map() + #uses Mercator projection as default
    theme_nothing(legend = TRUE) +  #to get rid of everything
    theme(legend.justification = c(0,0), legend.position = c(0,0)) + #put legend in left corner
    guides(fill = guide_legend(reverse = TRUE)) + #reverse legend colors
    transparent_legend
}

belgie_fortify &lt;- readRDS(&quot;belgie_fortify.rds&quot;)
finaldata00 &lt;- readRDS(&quot;finaldata.rds&quot;) #combination of data frames: inwoners, inkomen, data1997, zipcodes and verkeer
belgieDat &lt;- readRDS(&quot;belgieDat.rds&quot;)
finaldata &lt;- finaldata00 %&gt;% 
  left_join(., belgieDat) %&gt;% 
  arrange(ID_4)

colnames(finaldata) &lt;- colnames(finaldata) %&gt;% tolower()

glimpse(finaldata)

#add both vectors to the original data set 
finaldata0 &lt;- finaldata %&gt;% 
  mutate(ratio.nclaims.exp.cut = cut(ratio.nclaims.exp, 
                                     breaks = fisher7(ratio.nclaims.exp), 
                                     include.lowest = TRUE)) %&gt;% 
  mutate(nclaims.cut = cut(nclaims, breaks = fisher7(nclaims), include.lowest = TRUE)) %&gt;%
  mutate(exp.cut = cut(exp, breaks = fisher7(exp), include.lowest = TRUE, dig.lab = 4)) 

colnames(finaldata0) &lt;- colnames(finaldata0) %&gt;% tolower()

colnames(belgie_fortify) &lt;- colnames(belgie_fortify) %&gt;% tolower()

#merge this with shapefile to plot the map
belgie_fortify0 &lt;- left_join(belgie_fortify, finaldata0)

#plot ratio 
ratio.map &lt;- map_belgium_disc(belgie_fortify0, aes(fill = ratio.nclaims.exp.cut), &quot;Ratio&quot;, palette = Blues7)
ggplotly(ratio.map)</code></pre>
<p>It is observed that in the Brussels-Capital Region many municipalities exist with higher ratios compared to the nation-wide average.</p>
</div>

</div> <!-- articleBandContent -->
</div> <!-- pageContent -->

<div id="rStudioFooter" class="band full">
<div class="bandContent">
  <div id="copyright">© Copyright 2017 RStudio inc.</div>
  <div id="logos">
    <a href="https://github.com/MHaringa" class="footerLogo gitHub"></a>
    <a href="https://www.linkedin.com/in/martin-haringa-71a7a61b" class="footerLogo linkedIn"></a>
  </div>
</div>
</div>

<!-- bizible -->
<script type="text/javascript" src="//cdn.bizible.com/scripts/bizible.js" async=""></script>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>


</body>
</html>
